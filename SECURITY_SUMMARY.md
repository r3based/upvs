# üîí –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. Docker –∏–∑–æ–ª—è—Ü–∏—è (L4)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.yml`:**
- ‚úÖ PostgreSQL: –ø–æ—Ä—Ç—ã –ù–ï –ø—É–±–ª–∏–∫—É—é—Ç—Å—è (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Docker network)
- ‚úÖ API: –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –¢–û–õ–¨–ö–û –Ω–∞ localhost (127.0.0.1:8000)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å `upvs_internal`
- ‚úÖ –ü–∞—Ä–æ–ª—å PostgreSQL –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã, —Å–Ω–∞—Ä—É–∂–∏ –¥–æ—Å—Ç—É–ø –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ Nginx.

---

### 2. FastAPI hardening (L5)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `apps/api/main.py`:**
- ‚úÖ Swagger UI –æ—Ç–∫–ª—é—á—ë–Ω (`docs_url=None`)
- ‚úÖ ReDoc –æ—Ç–∫–ª—é—á—ë–Ω (`redoc_url=None`)
- ‚úÖ OpenAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç –æ—Ç–∫–ª—é—á—ë–Ω (`openapi_url=None`)
- ‚úÖ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ (–∏–∑ `ALLOWED_ORIGINS`)
- ‚úÖ CORS –º–µ—Ç–æ–¥—ã: —Ç–æ–ª—å–∫–æ GET, POST
- ‚úÖ CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏: —Ç–æ–ª—å–∫–æ Authorization, Content-Type

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏, —Å—Ç—Ä–æ–≥–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.

---

### 3. OpenAPI —ç–∫—Å–ø–æ—Ä—Ç (L5)

**–°–æ–∑–¥–∞–Ω `scripts/export_openapi.py`:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `openapi.json` —Ñ–∞–π–ª –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ HTTP
- ‚úÖ –ó–∞–ø—É—Å–∫: `docker compose exec api python scripts/export_openapi.py`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** OpenAPI schema –¥–æ—Å—Ç—É–ø–µ–Ω –¢–û–õ–¨–ö–û –∫–∞–∫ —Ñ–∞–π–ª, –Ω–µ —á–µ—Ä–µ–∑ API.

---

### 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤ (L6)

**–°–æ–∑–¥–∞–Ω `scripts/generate_secrets.sh`:**
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–ª—å–Ω—ã–π API_KEY (32 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–∏–ª—å–Ω—ã–π POSTGRES_PASSWORD (32 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –§–æ—Ä–º–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π DATABASE_URL

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–µ–∫—Ä–µ—Ç–æ–≤.

---

### 5. Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (L4)

**–°–æ–∑–¥–∞–Ω `nginx/upvs-secure.conf`:**
- ‚úÖ HTTPS only (HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç)
- ‚úÖ TLS 1.2/1.3, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∏—Ñ—Ä—ã
- ‚úÖ HSTS (1 –≥–æ–¥)
- ‚úÖ Security headers (CSP, X-Frame-Options, etc.)
- ‚úÖ Rate limiting (5 req/s –æ–±—â–∏–π, 2 req/s –ø–æ–∏—Å–∫)
- ‚úÖ Connection limiting (10 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö)
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ `/docs`, `/redoc`, `/openapi.json`
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫–∞–Ω–µ—Ä–æ–≤ (`/wp-admin`, `/.env`, etc.)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ reverse proxy.

---

### 6. –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (L1-L3)

**–°–æ–∑–¥–∞–Ω–æ 4 —Å–∫—Ä–∏–ø—Ç–∞ –≤ `scripts/security/`:**

1. **`setup_firewall.sh`:**
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ UFW
   - –ü–æ–ª–∏—Ç–∏–∫–∞ deny incoming
   - –û—Ç–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ 22, 443 (–∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ 80)

2. **`setup_fail2ban.sh`:**
   - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Fail2Ban
   - Jail –¥–ª—è SSH, Nginx
   - Ban time: 24h, max retry: 3

3. **`harden_ssh.sh`:**
   - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ root login
   - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
   - –¢–æ–ª—å–∫–æ SSH –∫–ª—é—á–∏
   - –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

4. **`setup_all.sh`:**
   - –ú–∞—Å—Ç–µ—Ä-—Å–∫—Ä–∏–ø—Ç –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
   - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Docker logging

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è hardening –∑–∞ 5 –º–∏–Ω—É—Ç.

---

### 7. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (Doc)

**–°–æ–∑–¥–∞–Ω–æ:**
- ‚úÖ `SECURITY.md` - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (7000+ —Å–ª–æ–≤)
- ‚úÖ `nginx/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ `.env.production.example` - –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–¥–∞–∫—à–Ω –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –û–±–Ω–æ–≤–ª—ë–Ω `ENV_EXAMPLE.txt` —Å –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò—Å—á–µ—Ä–ø—ã–≤–∞—é—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –≤—Å–µ–º –∞—Å–ø–µ–∫—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ vs –ü–æ—Å–ª–µ

| –ê—Å–ø–µ–∫—Ç | –î–æ | –ü–æ—Å–ª–µ |
|--------|-----|-------|
| **Docker –ø–æ—Ä—Ç—ã** | PostgreSQL 5432 –æ—Ç–∫—Ä—ã—Ç | –¢–æ–ª—å–∫–æ localhost |
| **API –¥–æ—Å—Ç—É–ø** | –ù–∞–ø—Ä—è–º—É—é –Ω–∞ :8000 | –¢–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Nginx |
| **Swagger UI** | –ü—É–±–ª–∏—á–Ω—ã–π | –û—Ç–∫–ª—é—á—ë–Ω |
| **OpenAPI schema** | HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç | –¢–æ–ª—å–∫–æ —Ñ–∞–π–ª |
| **CORS** | `allow_origins=["*"]` | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ |
| **API Key** | –î–µ—Ñ–æ–ª—Ç–Ω—ã–π | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π (32 char) |
| **PostgreSQL –ø–∞—Ä–æ–ª—å** | `upvs` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π (32 char) |
| **Firewall** | –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | UFW (—Ç–æ–ª—å–∫–æ 22, 443) |
| **Rate limiting** | –ù–µ—Ç | Nginx: 5 req/s |
| **SSL/TLS** | –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω | TLS 1.2/1.3 |
| **Security headers** | –ù–µ—Ç | 6 headers |
| **IDS** | –ù–µ—Ç | Fail2Ban |
| **SSH** | –ü–∞—Ä–æ–ª–∏ | –¢–æ–ª—å–∫–æ –∫–ª—é—á–∏ |
| **–ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | –ù–µ—Ç | –î–∞ |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –ù–µ—Ç | –õ–æ–≥–∏ + –º–µ—Ç—Ä–∏–∫–∏ |

---

## üéØ –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

### –°–Ω–∞—Ä—É–∂–∏ (Internet)

```
$ nmap your-domain.com

PORT    STATE
22/tcp  open   ssh
443/tcp open   https

‚úÖ –¢–æ–ª—å–∫–æ 2 –ø–æ—Ä—Ç–∞ –æ—Ç–∫—Ä—ã—Ç—ã
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞—â–∏—Ç—ã

```bash
# 1. Swagger –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
$ curl https://your-domain.com/docs
404 Not Found ‚úÖ

# 2. OpenAPI –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
$ curl https://your-domain.com/openapi.json
404 Not Found ‚úÖ

# 3. API —Ç—Ä–µ–±—É–µ—Ç Bearer
$ curl https://your-domain.com/api/tree
{"detail":"Not authenticated"} ‚úÖ

# 4. API —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª—é—á–æ–º
$ curl -H "Authorization: Bearer KEY" https://your-domain.com/api/tree
{"tree": [...]} ‚úÖ

# 5. Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
$ for i in {1..20}; do curl ...; done
# –ü–æ—Å–ª–µ 5 –∑–∞–ø—Ä–æ—Å–æ–≤: 503 Service Temporarily Unavailable ‚úÖ

# 6. Security headers
$ curl -I https://your-domain.com/api/tree
Strict-Transport-Security: max-age=31536000 ‚úÖ
X-Frame-Options: DENY ‚úÖ
X-Content-Type-Options: nosniff ‚úÖ
Content-Security-Policy: default-src 'none' ‚úÖ
```

---

## üìã Checklist –¥–ª—è –¥–µ–ø–ª–æ—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å `sudo bash scripts/security/setup_all.sh`
- [ ] –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–µ–∫—Ä–µ—Ç—ã: `bash scripts/generate_secrets.sh > .env`
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Nginx: —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å `nginx/upvs-secure.conf`
- [ ] –ó–∞–º–µ–Ω–∏—Ç—å `your-domain.com` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
- [ ] –ü–æ–ª—É—á–∏—Ç—å SSL: `sudo certbot --nginx -d your-domain.com`
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å: `docker compose up -d`
- [ ] –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å OpenAPI: `docker compose exec api python scripts/export_openapi.py`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –≤—ã—à–µ ‚òùÔ∏è

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backup PostgreSQL (cron)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus + Grafana)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã (Telegram bot)
- [ ] –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤ (logrotate)

---

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ

### ‚ö†Ô∏è –ü–ï–†–ï–î –∑–∞–ø—É—Å–∫–æ–º SSH hardening:

1. **–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ SSH –∫–ª—é—á –Ω–∞—Å—Ç—Ä–æ–µ–Ω:**
   ```bash
   ssh-copy-id user@server
   ```

2. **–ù–ï –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Ç–µ–∫—É—â—É—é SSH —Å–µ—Å—Å–∏—é**

3. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤—Ç–æ—Ä—É—é SSH —Å–µ—Å—Å–∏—é –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏**

4. **–¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ç–æ—Ä–æ–π —Å–µ—Å—Å–∏–∏ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –ø–µ—Ä–≤—É—é**

### ‚ö†Ô∏è –ü–ï–†–ï–î —Å–º–µ–Ω–æ–π API_KEY:

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π –∫–ª—é—á** (–Ω–∞ —Å–ª—É—á–∞–π –æ—Ç–∫–∞—Ç–∞)

2. **–û–±–Ω–æ–≤–∏—Ç–µ –≤ ChatGPT Actions**

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É API —Å –Ω–æ–≤—ã–º –∫–ª—é—á–æ–º**

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [SECURITY.md](./SECURITY.md)
- **Nginx –∫–æ–Ω—Ñ–∏–≥:** [nginx/README.md](./nginx/README.md)
- **–ü—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ–π:** [PRODUCTION.md](./PRODUCTION.md)
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ ChatGPT:** [CHATGPT_SETUP.md](./CHATGPT_SETUP.md)

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**UPVS API —Ç–µ–ø–µ—Ä—å –∑–∞—â–∏—â—ë–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ enterprise-grade:**

‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å –∞—Ç–∞–∫–∏ (—Ç–æ–ª—å–∫–æ 443)  
‚úÖ Defense in Depth (7 —É—Ä–æ–≤–Ω–µ–π –∑–∞—â–∏—Ç—ã)  
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞ (Fail2Ban, rate limiting)  
‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (TLS 1.3, security headers)  
‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è  
‚úÖ –ü—Ä–æ—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–º–∞—Å—Ç–µ—Ä-—Å–∫—Ä–∏–ø—Ç)

**–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Å ChatGPT Actions!** üöÄ

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 2026-01-09

