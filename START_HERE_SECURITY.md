# ๐ UPVS API - ะะตััะธั 2.0 ั Enterprise Security

## โ ะะกะ ะะะะะะะะะฏ ะะะะกะะะซ!

ะัะพะตะบั **ะฟะพะปะฝะพัััั ะฟะตัะตะดะตะปะฐะฝ** ั ััััะพะผ ะฒัะตั ััะตะฑะพะฒะฐะฝะธะน ะฑะตะทะพะฟะฐัะฝะพััะธ ะธะท ะฒะฐัะตะณะพ ะฟะปะฐะฝะฐ.

---

## ๐ฏ ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ (ะบัะฐัะบะพ)

### 1. Docker ะธะทะพะปััะธั โ
- PostgreSQL: ะฟะพััั ะทะฐะบัััั
- API: ัะพะปัะบะพ localhost:8000
- ะะฝัััะตะฝะฝัั ัะตัั Docker

### 2. FastAPI hardening โ
- Swagger UI ะพัะบะปัััะฝ
- OpenAPI ัะฝะดะฟะพะธะฝั ะพัะบะปัััะฝ
- CORS ะพะณัะฐะฝะธัะตะฝ
- Bearer Token ะฝะฐ ะฒัะตั API

### 3. Nginx ะบะพะฝัะธะณััะฐัะธั โ
- Rate limiting (5 req/s)
- Security headers
- TLS 1.2/1.3
- ะะปะพะบะธัะพะฒะบะฐ ัะปัะถะตะฑะฝัั ะฟััะตะน

### 4. ะะฒัะพะผะฐัะธะทะฐัะธั โ
- 4 ัะบัะธะฟัะฐ ะดะปั ะฟะพะปะฝะพะน ะฝะฐัััะพะนะบะธ
- ะะตะฝะตัะฐัะธั ัะตะบัะตัะพะฒ
- ะญะบัะฟะพัั OpenAPI ะฒ ัะฐะนะป

### 5. ะะพะบัะผะตะฝัะฐัะธั โ
- SECURITY.md (7000+ ัะปะพะฒ)
- SECURITY_SUMMARY.md
- nginx/README.md
- ะะฑะฝะพะฒะปัะฝ README.md

---

## ๐ ะัััััะน ััะฐัั ะฝะฐ ัะตัะฒะตัะต

### ะจะฐะณ 1: ะะปะพะฝะธััะนัะต ะฟัะพะตะบั

```bash
cd ~
git clone YOUR_REPO upvs
cd upvs
```

### ะจะฐะณ 2: ะะฐะฟัััะธัะต ะฐะฒัะพะผะฐัะธัะตัะบัั ะฝะฐัััะพะนะบั ะฑะตะทะพะฟะฐัะฝะพััะธ

```bash
sudo bash scripts/security/setup_all.sh
```

ะญัะพ ะฝะฐัััะพะธั:
- โ UFW Firewall (ัะพะปัะบะพ 22, 443)
- โ Fail2Ban (ะทะฐัะธัะฐ ะพั ะฑััััะพััะฐ)
- โ SSH hardening (ัะพะปัะบะพ ะบะปััะธ)
- โ ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธั ัะธััะตะผั
- โ Docker logging limits

**ะัะตะผั:** ~5-10 ะผะธะฝัั

### ะจะฐะณ 3: ะกะณะตะฝะตัะธััะนัะต ัะตะบัะตัั

```bash
bash scripts/generate_secrets.sh
```

ะกะบะพะฟะธััะนัะต ะฒัะฒะพะด ะธ ัะพะทะดะฐะนัะต `.env` ัะฐะนะป:

```bash
nano .env
# ะััะฐะฒััะต ัะณะตะฝะตัะธัะพะฒะฐะฝะฝัะต ะทะฝะฐัะตะฝะธั
```

**โ๏ธ ะะะะะ:** ะกะพััะฐะฝะธัะต ัะตะบัะตัั ะฒ ะฑะตะทะพะฟะฐัะฝะพะผ ะผะตััะต!

### ะจะฐะณ 4: ะะฐัััะพะนัะต Nginx

```bash
# ะกะบะพะฟะธัะพะฒะฐัั ะบะพะฝัะธะณ
sudo cp nginx/upvs-secure.conf /etc/nginx/sites-available/upvs

# ะะฐะผะตะฝะธัั ะดะพะผะตะฝ
sudo nano /etc/nginx/sites-available/upvs
# ะะฐะนะดะธัะต ะธ ะทะฐะผะตะฝะธัะต: your-domain.com โ ะฒะฐั-ะดะพะผะตะฝ.ru

# ะะบัะธะฒะธัะพะฒะฐัั
sudo ln -s /etc/nginx/sites-available/upvs /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### ะจะฐะณ 5: ะะพะปััะธัะต SSL ัะตััะธัะธะบะฐั

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d ะฒะฐั-ะดะพะผะตะฝ.ru
```

### ะจะฐะณ 6: ะะฐะฟัััะธัะต ะฟัะพะตะบั

```bash
docker compose up -d
```

**ะัะตะผั ะทะฐะฟััะบะฐ:** ~30-60 ัะตะบัะฝะด

### ะจะฐะณ 7: ะญะบัะฟะพััะธััะนัะต OpenAPI schema

```bash
docker compose exec api python scripts/export_openapi.py
```

ะคะฐะนะป `openapi.json` ะฑัะดะตั ัะพะทะดะฐะฝ ะฒ ะบะพัะฝะต ะฟัะพะตะบัะฐ.

---

## โ ะัะพะฒะตัะบะฐ ััะพ ะฒัั ัะฐะฑะพัะฐะตั

```bash
# 1. Health check
curl https://ะฒะฐั-ะดะพะผะตะฝ.ru/health
# ะะถะธะดะฐะตััั: {"status":"ok"}

# 2. Swagger ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ
curl https://ะฒะฐั-ะดะพะผะตะฝ.ru/docs
# ะะถะธะดะฐะตััั: 404

# 3. OpenAPI ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ
curl https://ะฒะฐั-ะดะพะผะตะฝ.ru/openapi.json
# ะะถะธะดะฐะตััั: 404

# 4. API ััะตะฑัะตั Bearer Token
curl https://ะฒะฐั-ะดะพะผะตะฝ.ru/api/tree
# ะะถะธะดะฐะตััั: {"detail":"Not authenticated"}

# 5. API ัะฐะฑะพัะฐะตั ั ัะพะบะตะฝะพะผ
curl -H "Authorization: Bearer ะะะจ_API_KEY" \
     https://ะฒะฐั-ะดะพะผะตะฝ.ru/api/tree
# ะะถะธะดะฐะตััั: {"tree": [...]}
```

ะัะปะธ ะฒัะต ัะตััั ะฟัะพัะปะธ - **ะฒัั ัะฐะฑะพัะฐะตั! โ**

---

## ๐ค ะะฐัััะพะนะบะฐ ChatGPT Action

### 1. ะัะบัะพะนัะต ัะฐะนะป openapi.json

```bash
cat openapi.json
```

ะะปะธ ัะบะพะฟะธััะนัะต ัะฐะนะป ะฝะฐ ะปะพะบะฐะปัะฝัะน ะบะพะผะฟัััะตั:

```bash
# ะะฐ ะปะพะบะฐะปัะฝะพะผ ะบะพะผะฟัััะตัะต:
scp user@server:~/upvs/openapi.json .
```

### 2. ะ ChatGPT ัะพะทะดะฐะนัะต Action

1. ะะตัะตะนะดะธัะต ะฒ ChatGPT โ Configure โ Actions
2. ะกะพะทะดะฐะนัะต ะฝะพะฒัะน GPT ั Action
3. ะะผะฟะพััะธััะนัะต `openapi.json`
4. ะะฐัััะพะนัะต ะฐััะตะฝัะธัะธะบะฐัะธั:
   - **Auth Type**: Bearer
   - **Token**: ะฒะฐั API_KEY ะธะท `.env`

### 3. ะัะพัะตััะธััะนัะต

ะกะฟัะพัะธัะต ั ะฒะฐัะตะณะพ GPT:
```
ะะฐะบะธะต ัะฐะทะดะตะปั ะตััั ะฒ ัะฟัะฐะฒะพัะฝะธะบะต UPVS?
```

ะะพะปะถะตะฝ ะฟะพะปััะธัั ะพัะฒะตั ั ะดะตัะตะฒะพะผ ัะฐะทะดะตะปะพะฒ.

**ะะพะดัะพะฑะฝะตะต:** [CHATGPT_SETUP.md](./CHATGPT_SETUP.md)

---

## ๐ ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั

### ะะปะฐะฒะฝัะต ัะฐะนะปั:

1. **[START_HERE.md](./START_HERE.md)** - ะพะฑัะธะน ะพะฑะทะพั ะฟัะพะตะบัะฐ
2. **[SECURITY.md](./SECURITY.md)** - ะฟะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ ะฟะพ ะฑะตะทะพะฟะฐัะฝะพััะธ (7000+ ัะปะพะฒ)
3. **[SECURITY_SUMMARY.md](./SECURITY_SUMMARY.md)** - ะบัะฐัะบะพะต ัะตะทัะผะต ะธะทะผะตะฝะตะฝะธะน
4. **[PRODUCTION.md](./PRODUCTION.md)** - ะดะตะฟะปะพะน ะฒ ะฟัะพะดะฐะบัะตะฝ
5. **[CHATGPT_SETUP.md](./CHATGPT_SETUP.md)** - ะฝะฐัััะพะนะบะฐ ChatGPT Actions

### ะะพะฝัะธะณััะฐัะธั ะธ ัะบัะธะฟัั:

6. **[nginx/README.md](./nginx/README.md)** - ะดะพะบัะผะตะฝัะฐัะธั Nginx
7. **[SECURITY_FILES.md](./SECURITY_FILES.md)** - ัะฟะธัะพะบ ะฒัะตั ัะฐะนะปะพะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ
8. `scripts/security/*` - ัะบัะธะฟัั ะฐะฒัะพะผะฐัะธะทะฐัะธะธ

---

## ๐ ะััะธัะตะบัััะฐ ะฑะตะทะพะฟะฐัะฝะพััะธ

```
Internet (โ๏ธ ะัะฐะถะดะตะฑะฝะฐั ััะตะดะฐ)
    โ ะขะะะฌะะ 443 (HTTPS)
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L1: OS (Ubuntu)         โ โ ะะฒัะพะพะฑะฝะพะฒะปะตะฝะธั, hardening
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L2: Firewall (UFW)      โ โ Deny all (ะบัะพะผะต 22, 443)
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L3: IDS (Fail2Ban)      โ โ Auto-ban ะฑััััะพัั, abuse
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L4: Reverse Proxy       โ โ Rate limit, Security headers
โ     (Nginx)             โ โ Block /docs, /openapi.json
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
            โ localhost:8000
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L5: Application         โ โ Bearer Token auth
โ     (FastAPI)           โ โ CORS restricted
โ                         โ โ Swagger OFF
โโโโโโโโโโโโโฌโโโโโโโโโโโโโโ
            โ Docker network (internal)
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ L6: Database            โ โ ะะตะท ะฒะฝะตัะฝะธั ะฟะพััะพะฒ
โ     (PostgreSQL)        โ โ ะกะธะปัะฝัะน ะฟะฐัะพะปั
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**7 ััะพะฒะฝะตะน ะทะฐัะธัั!** ะะฐะถะดัะน ััะพะฒะตะฝั ะฝะตะทะฐะฒะธัะธะผ.

---

## ๐ ะกัะฐะฒะฝะตะฝะธะต: ะัะปะพ โ ะกัะฐะปะพ

| ะะฐัะฐะผะตัั | ะัะปะพ | ะกัะฐะปะพ |
|----------|------|-------|
| ะัะบััััะต ะฟะพััั | 5432, 8000 | ะขะะะฌะะ 443 |
| Swagger UI | ะัะฑะปะธัะฝัะน | โ ะัะบะปัััะฝ |
| OpenAPI | HTTP ัะฝะดะฟะพะธะฝั | โ ะขะพะปัะบะพ ัะฐะนะป |
| CORS | `*` (ะฒัะต) | ะะณัะฐะฝะธัะตะฝะฝัะน ัะฟะธัะพะบ |
| API Key | ะะตัะพะปัะฝัะน | 32-char generated |
| PostgreSQL ะฟะฐัะพะปั | `upvs` | 32-char generated |
| Firewall | โ | โ UFW |
| Rate limiting | โ | โ 5 req/s |
| IDS | โ | โ Fail2Ban |
| SSH | ะะฐัะพะปะธ | โ ะขะพะปัะบะพ ะบะปััะธ |
| SSL/TLS | โ | โ TLS 1.2/1.3 |
| Security headers | โ | โ 6 headers |

---

## ๐ฏ ะงัะพ ะดะฐะปััะต?

### ะะฑัะทะฐัะตะปัะฝะพ:
1. โ ะัะพะฒะตัะธัั ะฒัะต ัะตััั ะฒััะต
2. โ ะะฐัััะพะธัั ChatGPT Action
3. โ ะกะพััะฐะฝะธัั backup ัะตะบัะตัะพะฒ

### ะะตะบะพะผะตะฝะดัะตััั:
1. ๐ ะะฐัััะพะธัั ะผะพะฝะธัะพัะธะฝะณ (Prometheus + Grafana)
2. ๐พ ะะฐัััะพะธัั ะฐะฒัะพะผะฐัะธัะตัะบะธะน backup PostgreSQL
3. ๐ฑ ะะฐัััะพะธัั ะฐะปะตััั (Telegram bot)
4. ๐ ะะฐัััะพะธัั ัะพัะฐัะธั ะปะพะณะพะฒ

### ะะตะณัะปััะฝะพ:
- ะัะพะฒะตัััั ะปะพะณะธ Fail2Ban: `sudo fail2ban-client status`
- ะะฑะฝะพะฒะปััั ัะธััะตะผั: `sudo apt update && sudo apt upgrade`
- ะัะพะฒะตัััั SSL: `sudo certbot certificates`

---

## ๐ ะะพะผะพัั

### ะงัะพ-ัะพ ะฝะต ัะฐะฑะพัะฐะตั?

1. **ะงะธัะฐะนัะต ะปะพะณะธ:**
   ```bash
   docker compose logs -f api
   sudo tail -f /var/log/nginx/upvs_error.log
   ```

2. **ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั:**
   ```bash
   docker compose config
   sudo nginx -t
   ```

3. **ะัะพะฒะตัััะต firewall:**
   ```bash
   sudo ufw status verbose
   ```

### ะะพะบัะผะตะฝัะฐัะธั:

- **API ะฝะต ะพัะฒะตัะฐะตั:** [PRODUCTION.md](./PRODUCTION.md) โ Troubleshooting
- **Nginx ะพัะธะฑะบะธ:** [nginx/README.md](./nginx/README.md) โ Troubleshooting
- **ะะพะฟัะพัั ะฑะตะทะพะฟะฐัะฝะพััะธ:** [SECURITY.md](./SECURITY.md)

---

## ๐ ะะพัะพะฒะพ!

**UPVS API ะทะฐัะธััะฝ ะฝะฐ ััะพะฒะฝะต enterprise-grade ะธ ะณะพัะพะฒ ะบ ัะฐะฑะพัะต ั ChatGPT Actions!**

### ะกะปะตะดัััะธะต ัะฐะณะธ:
1. ะะฐะฟัััะธัะต: `sudo bash scripts/security/setup_all.sh`
2. ะะฐัััะพะนัะต: Nginx + SSL
3. ะะตะฟะปะพะนัะต: `docker compose up -d`
4. ะัะพะฒะตัััะต: ะฒัะต ัะตััั ะฒััะต
5. ะะฐัััะพะนัะต: ChatGPT Action

**ะฃัะฟะตัะพะฒ! ๐**

---

**ะะตััะธั:** 2.0.0 (Security Hardened)  
**ะะฐัะฐ:** 2026-01-09

